<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Tiled Texture Mask with Point Blob</title>
    <style>
      body {
        background: #eee;
        padding: 20px;
      }
      svg {
        border: 1px solid #ccc;
      }
    </style>
  </head>
  <body>
    <svg id="viz" width="600" height="400">
      <defs>
        <pattern
          id="waterTile"
          patternUnits="userSpaceOnUse"
          width="200"
          height="140"
        >
          <image
            href="https://i0.wp.com/2minutetabletop.com/wp-content/uploads/2019/04/Ocean-sea-water-tile-texture-map-assets-storm.jpg?fit=1000%2C700&ssl=1"
            width="200"
            height="140"
          />
        </pattern>

        <pattern
          id="landTile"
          patternUnits="userSpaceOnUse"
          width="100"
          height="100"
        >
          <image
            href="https://opengameart.org/sites/default/files/tileable-s7002876-sample_1.png"
            width="100"
            height="100"
          />
        </pattern>

        <filter id="glowFilter" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="3" result="blur" />
          <feMerge>
            <feMergeNode in="blur" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>

        <mask id="landMask">
          <rect width="600" height="400" fill="black" />
          <g id="maskPoints"></g>
        </mask>
      </defs>

      <rect width="600" height="400" fill="url(#waterTile)" />
      <rect
        width="600"
        height="400"
        fill="url(#landTile)"
        mask="url(#landMask)"
      />
      <g
        id="hoverOverlay"
        style="mix-blend-mode: screen; pointer-events: none"
      ></g>
    </svg>

    <script>
      const hoverEffect = "glow"; // glow or lighten
      const svgNS = "http://www.w3.org/2000/svg";
      const group = document.getElementById("maskPoints");

      const circles = [];

      // Create a blob of semi-transparent circles
      for (let i = 0; i < 250; i++) {
        const cx = 300 + 100 * (Math.random() - 0.5);
        const cy = 200 + 100 * (Math.random() - 0.5);
        const r = 6 + 6 * Math.random();
        const baseOpacity = 0.3 + 0.4 * Math.random();

        const circle = document.createElementNS(svgNS, "circle");
        circle.setAttribute("cx", cx);
        circle.setAttribute("cy", cy);
        circle.setAttribute("r", r);
        circle.setAttribute("fill", "white");
        circle.setAttribute("fill-opacity", baseOpacity);

        // Save for later
        circles.push({ el: circle, cx, cy, baseOpacity });
        group.appendChild(circle);
      }

      const hoverOverlay = document.getElementById("hoverOverlay");

      // Make texture circles
      circles.forEach(({ cx, cy }) => {
        const overlayCircle = document.createElementNS(svgNS, "circle");
        overlayCircle.setAttribute("cx", cx);
        overlayCircle.setAttribute("cy", cy);
        overlayCircle.setAttribute("r", 0);
        // overlayCircle.setAttribute("fill", "white");
        // overlayCircle.setAttribute("fill-opacity", 0);
        overlayCircle.setAttribute("fill", "#ff7f0e");
        overlayCircle.setAttribute("fill-opacity", 0.5);
        hoverOverlay.appendChild(overlayCircle);
      });

      const svg = document.getElementById("viz");

      svg.addEventListener("mousemove", (e) => {
        const pt = svg.createSVGPoint();
        pt.x = e.clientX;
        pt.y = e.clientY;
        const cursor = pt.matrixTransform(svg.getScreenCTM().inverse());

        const hoverRadius = 30;

        [...hoverOverlay.children].forEach((el, i) => {
          const { cx, cy } = circles[i];
          const dist = Math.hypot(cx - cursor.x, cy - cursor.y);
          if (dist < hoverRadius) {
            el.setAttribute("r", 12);
            el.setAttribute("fill-opacity", 0.5);
          } else {
            el.setAttribute("r", 0);
            el.setAttribute("fill-opacity", 0);
          }
        });
      });

      svg.addEventListener("mouseleave", () => {
        circles.forEach(({ el, baseOpacity }) => {
          el.setAttribute("fill-opacity", baseOpacity);
        });
      });
    </script>
  </body>
</html>
