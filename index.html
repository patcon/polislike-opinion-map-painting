<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <link rel="stylesheet" href="styles.css" />
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css"
    />
  </head>
  <body>
    <a
      class="github-fork-ribbon"
      href="https://github.com/patcon/polislike-opinion-map-painting"
      data-ribbon="Fork me on GitHub"
      title="Fork me on GitHub"
      >Fork me on GitHub</a
    >

    <label for="color">Custom color: </label>
    <input type="color" id="color" value="#1f77b4" />
    <label>
      <input type="checkbox" id="toggle-additive" />
      Additive painting by default
    </label>
    <small style="color: #555">(Otherwise, Cmd-click for additive)</small>

    <div style="display: flex; align-items: center; gap: 12px">
      <div id="color-palette"></div>
      <small style="color: #555"> Press keys 0–9 to select colors </small>
    </div>

    <label for="dataset">Dataset:</label>
    <select id="dataset">
      <option value="bg2050">Bowling Green 2050</option>
      <option value="jean-lou">Jean-Lou AI convo</option>
      <option value="demdis-eu-9usurb2mmh">DemDis: EU isolation</option>
      <!-- Add more dataset folders here -->
    </select>

    <label>
      <input type="checkbox" id="flip-x-checkbox" />
      Flip X axis
    </label>
    <label>
      <input type="checkbox" id="flip-y-checkbox" />
      Flip Y axis
    </label>

    <div
      id="share-controls"
      style="
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
        font-family: sans-serif;
      "
    >
      <button id="share-button" style="padding: 4px 10px">
        Share painted labels
      </button>
      <input
        id="share-url"
        readonly
        style="
          flex: 1;
          font-size: 12px;
          padding: 4px 6px;
          border: 1px solid #ccc;
        "
        placeholder="Shareable link will appear here"
      />
    </div>

    <div
      id="plot-loader"
      style="
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.6);
        z-index: 999;
        pointer-events: all;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: sans-serif;
        font-size: 16px;
        font-weight: bold;
        color: #333;
      "
    >
      <div
        class="spinner"
        style="
          width: 24px;
          height: 24px;
          border: 3px solid #ccc;
          border-top-color: #333;
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin-right: 12px;
        "
      ></div>
      Updating…
    </div>
    <div id="plot-wrapper">
      <svg id="plot1"></svg>
      <svg id="plot2"></svg>
      <svg id="plot3"></svg>
    </div>

    <div
      style="
        display: flex;
        align-items: center;
        gap: 20px;
        margin-top: 12px;
        font-family: sans-serif;
      "
    >
      <label style="display: flex; align-items: center; gap: 6px">
        <input type="checkbox" id="include-unpainted" />
        Include unpainted points as group
      </label>
      <div id="label-counts"></div>
    </div>
    <button id="run-analysis">Run Group Analysis</button>
    <label>
      <input type="checkbox" id="auto-analyze-checkbox" checked />
      Auto-analyze on selection
    </label>
    <div
      id="rep-warning"
      style="
        margin-top: 20px;
        background: #fff8e1;
        border: 1px solid #f1c40f;
        padding: 10px;
        font-family: sans-serif;
      "
    >
      ⚠️ <strong>Note:</strong> Representative group statement calculations are
      <em>broken</em> and don't give a clear story right now. See
      <a
        href="https://gist.github.com/patcon/0fe7e07ff9dae3a01b2ad49798d98306"
        target="_blank"
        >this data science analysis notebook</a
      >
      for a working (but non-dynamic) example of representative statements found
      for BG2050.
    </div>
    <div
      id="rep-comments-output"
      style="margin-top: 30px; font-family: sans-serif"
    ></div>

    <script src="app.js"></script>
    <script>
      const isMobile = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);

      if (isMobile && !sessionStorage.getItem("mobileWarningDismissed")) {
        const dialog = document.createElement("div");
        dialog.style.cssText = `
          position: fixed;
          top: 20px;
          left: 50%;
          transform: translateX(-50%);
          max-width: 400px;
          background: #fff8e1;
          border: 1px solid #f1c40f;
          border-radius: 8px;
          box-shadow: 0 4px 8px rgba(0,0,0,0.1);
          padding: 16px 20px 12px;
          font-family: sans-serif;
          z-index: 10000;
        `;

        const msg = document.createElement("div");
        msg.innerHTML = `
          <strong>⚠️ Painting not yet supported on mobile.</strong><br>
          Please use a desktop browser to assign group labels.
        `;

        const closeBtn = document.createElement("button");
        closeBtn.textContent = "✖";
        closeBtn.style.cssText = `
          position: absolute;
          top: 6px;
          right: 10px;
          background: none;
          border: none;
          font-size: 16px;
          cursor: pointer;
          color: #888;
        `;
        closeBtn.onclick = () => {
          dialog.remove();
          sessionStorage.setItem("mobileWarningDismissed", "1");
        };

        dialog.appendChild(closeBtn);
        dialog.appendChild(msg);
        document.body.appendChild(dialog);
      }
    </script>
  </body>
</html>
